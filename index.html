<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026大阪之旅 (可編輯版)</title>
    
    <!-- 1. 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. 載入 React 核心 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js" crossorigin="anonymous"></script>
    
    <!-- 3. 載入 Babel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js" crossorigin="anonymous"></script>

    <style>
        body { 
            background-color: #F0F0F0; 
            margin: 0; 
            padding: 0; 
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes slide-up { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slide-up 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
        
        input:focus, select:focus, textarea:focus { outline: 2px solid #F59E0B; outline-offset: -2px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        window.addEventListener('load', () => {
            try {
                const { useState, useEffect, useRef } = React;

                // --- 1. Icons ---
                const Icon = ({ path, size = 24, className = "", ...props }) => (
                    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{path}</svg>
                );

                const Icons = {
                    Calendar: <g><rect x="3" y="4" width="18" height="18" rx="2" ry="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" /></g>,
                    MapPin: <g><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" /><circle cx="12" cy="10" r="3" /></g>,
                    Train: <g><rect x="2" y="3" width="20" height="14" rx="2" /><line x1="8" y1="21" x2="8" y2="21" /><line x1="16" y1="21" x2="16" y2="21" /><path d="M2 17h20" /><path d="M4 17l1.5 4" /><path d="M20 17l-1.5 4" /></g>,
                    ShoppingBag: <g><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z" /><line x1="3" y1="6" x2="21" y2="6" /><path d="M16 10a4 4 0 0 1-8 0" /></g>,
                    Wallet: <g><path d="M20 12V8H6a2 2 0 0 1-2-2c0-1.1.9-2 2-2h12v4" /><path d="M4 6v12a2 2 0 0 0 2 2h14v-4" /><path d="M18 12a2 2 0 0 0-2 2c0 1.1.9 2 2 2h4v-4h-4z" /></g>,
                    List: <g><line x1="8" y1="6" x2="21" y2="6" /><line x1="8" y1="12" x2="21" y2="12" /><line x1="8" y1="18" x2="21" y2="18" /><line x1="3" y1="6" x2="3.01" y2="6" /><line x1="3" y1="12" x2="3.01" y2="12" /><line x1="3" y1="18" x2="3.01" y2="18" /></g>,
                    User: <g><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></g>,
                    Plus: <g><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></g>,
                    CheckCircle: <g><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></g>,
                    Plane: <g><path d="M2 22h20" /><path d="M12 2l3.09 10.91L21 16l-1.04 2.87-8.08-2.61L6.1 22 2.87 21l3.09-8.73L2 2" /></g>,
                    Home: <g><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></g>,
                    Settings: <g><circle cx="12" cy="12" r="3" /><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" /></g>,
                    Sparkles: <g><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" /><path d="M5 3v4" /><path d="M9 5H5" /><path d="M3 5h2" /><path d="M5 7v-2" /></g>,
                    Camera: <g><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z" /><circle cx="12" cy="13" r="3" /></g>,
                    Utensils: <g><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2" /><path d="M7 2v20" /><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7" /></g>,
                    X: <g><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></g>,
                    Navigation: <g><polygon points="3 11 22 2 13 21 11 13 3 11" /></g>,
                    ChevronRight: <g><polyline points="9 18 15 12 9 6" /></g>,
                    MoreHorizontal: <g><circle cx="12" cy="12" r="1" /><circle cx="19" cy="12" r="1" /><circle cx="5" cy="12" r="1" /></g>,
                    Edit: <g><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" /><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" /></g>,
                    Trash: <g><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" /></g>,
                    Save: <g><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" /><polyline points="17 21 17 13 7 13 7 21" /><polyline points="7 3 7 8 15 8" /></g>
                };

                const Calendar = (props) => <Icon path={Icons.Calendar} {...props} />;
                const MapPin = (props) => <Icon path={Icons.MapPin} {...props} />;
                const Train = (props) => <Icon path={Icons.Train} {...props} />;
                const ShoppingBag = (props) => <Icon path={Icons.ShoppingBag} {...props} />;
                const Wallet = (props) => <Icon path={Icons.Wallet} {...props} />;
                const List = (props) => <Icon path={Icons.List} {...props} />;
                const User = (props) => <Icon path={Icons.User} {...props} />;
                const Plus = (props) => <Icon path={Icons.Plus} {...props} />;
                const CheckCircle = (props) => <Icon path={Icons.CheckCircle} {...props} />;
                const Plane = (props) => <Icon path={Icons.Plane} {...props} />;
                const Home = (props) => <Icon path={Icons.Home} {...props} />;
                const Settings = (props) => <Icon path={Icons.Settings} {...props} />;
                const Sparkles = (props) => <Icon path={Icons.Sparkles} {...props} />;
                const Camera = (props) => <Icon path={Icons.Camera} {...props} />;
                const Utensils = (props) => <Icon path={Icons.Utensils} {...props} />;
                const X = (props) => <Icon path={Icons.X} {...props} />;
                const Navigation = (props) => <Icon path={Icons.Navigation} {...props} />;
                const ChevronRight = (props) => <Icon path={Icons.ChevronRight} {...props} />;
                const MoreHorizontal = (props) => <Icon path={Icons.MoreHorizontal} {...props} />;
                const Edit = (props) => <Icon path={Icons.Edit} {...props} />;
                const Trash = (props) => <Icon path={Icons.Trash} {...props} />;
                const Save = (props) => <Icon path={Icons.Save} {...props} />;

                // --- Theme ---
                const THEMES = {
                    gold: { name: '金閣', primary: 'bg-amber-500', secondary: 'bg-amber-100', text: 'text-amber-600', border: 'border-amber-500' },
                    green: { name: '宇治', primary: 'bg-emerald-600', secondary: 'bg-emerald-100', text: 'text-emerald-700', border: 'border-emerald-600' },
                    pink: { name: '哲學', primary: 'bg-rose-400', secondary: 'bg-rose-100', text: 'text-rose-500', border: 'border-rose-400' },
                    blue: { name: '鴨川', primary: 'bg-sky-500', secondary: 'bg-sky-100', text: 'text-sky-600', border: 'border-sky-500' },
                    grey: { name: '祇園', primary: 'bg-stone-600', secondary: 'bg-stone-200', text: 'text-stone-700', border: 'border-stone-600' },
                };

                const INITIAL_ITINERARY = [
                    {
                        day: 1, date: "1/17 (六)", 
                        spots: [
                            { id: 'start', type: 'start', name: "Vessel Inn Namba", time: "09:00", desc: "點擊導航", icon: 'Home' },
                            { id: 't1', type: 'transport', name: "御堂筋線", time: "約 15分", icon: 'Train' },
                            { id: 1, type: 'spot', name: "大阪城天守閣", sub: "大阪・中央區", time: "10:00", img: "https://images.unsplash.com/photo-1543789311-53644a4b27c1?auto=format&fit=crop&q=80&w=600", icon: 'MapPin' },
                            { id: 't2', type: 'transport', name: "JR環狀線", time: "約 20分", icon: 'Train' },
                            { id: 2, type: 'spot', name: "通天閣", sub: "新世界商店街", time: "12:00", img: "https://images.unsplash.com/photo-1590554881752-9a840e96e24c?auto=format&fit=crop&q=80&w=600", icon: 'MapPin' },
                            { id: 't3', type: 'transport', name: "步行", time: "約 10分", icon: 'User' },
                            { id: 3, type: 'food', name: "千房 大阪燒", sub: "大阪・道頓堀", time: "13:30", img: "https://images.unsplash.com/photo-1582450871972-ab5ca641643d?auto=format&fit=crop&q=80&w=600", icon: 'Utensils' },
                            { id: 4, type: 'shop', name: "心齋橋筋", sub: "藥妝採購", time: "15:00", img: "https://images.unsplash.com/photo-1590253232298-23961168f080?auto=format&fit=crop&q=80&w=600", icon: 'ShoppingBag' },
                            { id: 'end', type: 'return', name: "Vessel Inn Namba", time: "", desc: "點擊導航", icon: 'Home' },
                        ]
                    },
                    { day: 2, date: "1/18 (日)", spots: [] },
                    { day: 3, date: "1/19 (一)", spots: [] },
                    { day: 4, date: "1/20 (二)", spots: [] },
                    { day: 5, date: "1/21 (三)", spots: [] },
                ];

                // --- Components ---

                const Modal = ({ isOpen, onClose, children, title }) => {
                    if (!isOpen) return null;
                    return (
                        <div className="fixed inset-0 bg-black/60 z-[100] flex items-end justify-center backdrop-blur-sm transition-opacity duration-300">
                            <div className="bg-[#FDFCF8] w-full max-w-[480px] rounded-t-[2rem] p-6 animate-slide-up shadow-2xl max-h-[85vh] overflow-y-auto safe-area-bottom">
                                <div className="flex justify-between items-center mb-6 sticky top-0 bg-[#FDFCF8] z-10">
                                    <h3 className="font-bold text-xl text-stone-800 tracking-wide">{title}</h3>
                                    <button onClick={onClose} className="p-2 bg-stone-100 rounded-full hover:bg-stone-200 transition-colors">
                                        <X size={20} className="text-stone-500" />
                                    </button>
                                </div>
                                {children}
                            </div>
                        </div>
                    );
                };

                // 簡單的編輯/新增 Modal
                const EditSpotModal = ({ isOpen, onClose, initialData, onSave }) => {
                    const [formData, setFormData] = useState(initialData || { name: '', time: '', desc: '', type: 'spot' });

                    useEffect(() => {
                        if (isOpen && initialData) {
                            setFormData(initialData);
                        } else if (isOpen) {
                            setFormData({ name: '', time: '', desc: '', type: 'spot' });
                        }
                    }, [isOpen, initialData]);

                    const handleChange = (e) => {
                        setFormData({ ...formData, [e.target.name]: e.target.value });
                    };

                    const handleSubmit = () => {
                        onSave(formData);
                        onClose();
                    };

                    return (
                        <Modal isOpen={isOpen} onClose={onClose} title={initialData ? "編輯行程" : "新增行程"}>
                            <div className="flex flex-col gap-4">
                                <div>
                                    <label className="text-xs font-bold text-stone-400 uppercase">時間</label>
                                    <input name="time" value={formData.time} onChange={handleChange} placeholder="例如: 10:00" className="w-full bg-stone-50 p-3 rounded-xl mt-1" />
                                </div>
                                <div>
                                    <label className="text-xs font-bold text-stone-400 uppercase">名稱</label>
                                    <input name="name" value={formData.name} onChange={handleChange} placeholder="地點名稱" className="w-full bg-stone-50 p-3 rounded-xl mt-1 font-bold" />
                                </div>
                                <div>
                                    <label className="text-xs font-bold text-stone-400 uppercase">類型</label>
                                    <select name="type" value={formData.type} onChange={handleChange} className="w-full bg-stone-50 p-3 rounded-xl mt-1">
                                        <option value="spot">景點</option>
                                        <option value="food">美食</option>
                                        <option value="shop">購物</option>
                                        <option value="transport">交通</option>
                                        <option value="start">起點</option>
                                        <option value="return">終點</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="text-xs font-bold text-stone-400 uppercase">備註 / 導航描述</label>
                                    <input name="desc" value={formData.desc || ''} onChange={handleChange} placeholder="例如: 點擊導航" className="w-full bg-stone-50 p-3 rounded-xl mt-1" />
                                </div>
                                <button onClick={handleSubmit} className="w-full bg-amber-500 text-white font-bold py-4 rounded-xl mt-4 shadow-lg active:scale-95 transition-transform">
                                    儲存
                                </button>
                            </div>
                        </Modal>
                    );
                };

                // --- Views ---

                const HomeView = ({ theme, setThemeColor, setShowThemeSettings, showThemeSettings }) => {
                    // 省略 HomeView 內容以保持簡潔，與之前相同
                    const [wishlist, setWishlist] = useState([]);
                    const [showAddSpot, setShowAddSpot] = useState(false);
                    const [spotName, setSpotName] = useState('');

                    return (
                        <div className="pb-28 min-h-full bg-[#FDFCF8]">
                            <div className="relative h-[35vh] max-h-[400px] w-full overflow-hidden rounded-b-[2.5rem] shadow-xl">
                                <img src="https://images.unsplash.com/photo-1590253232298-23961168f080?auto=format&fit=crop&q=80&w=1000" alt="Dotonbori" className="w-full h-full object-cover brightness-[0.7]" />
                                <div className="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-black/30"></div>
                                <button onClick={() => setShowThemeSettings(true)} className="absolute top-12 right-6 p-2.5 bg-white/10 backdrop-blur-md rounded-full text-white border border-white/20 active:scale-95"><Settings size={20} /></button>
                                <div className="absolute bottom-8 left-8 text-white">
                                    <h1 className="text-4xl font-serif font-bold tracking-wider mb-2 drop-shadow-lg">2026大阪之旅</h1>
                                    <div className="flex items-center gap-2 opacity-90 text-sm font-medium tracking-widest bg-white/20 px-3 py-1 rounded-full w-fit backdrop-blur-sm">
                                        <Calendar size={14} /> <span>1/17 - 1/22</span>
                                    </div>
                                </div>
                            </div>
                            <div className="px-6 -mt-10 relative z-10">
                                <div className={`${theme.primary} rounded-3xl p-6 text-white shadow-xl shadow-stone-200 mb-6 relative overflow-hidden ring-4 ring-[#FDFCF8]`}>
                                    <div className="relative z-10"><h2 className="font-bold text-lg flex items-center gap-2 mb-1"><span className="text-xl">♥</span> 收藏清單</h2><p className="text-xs opacity-90 font-light">收錄想去的大阪角落。</p></div>
                                    <div className="absolute -right-4 -bottom-8 opacity-20 text-9xl font-serif select-none pointer-events-none">✿</div>
                                </div>
                                <button onClick={() => setShowAddSpot(true)} className={`w-full border-2 border-dashed ${theme.border} ${theme.text} bg-stone-50 rounded-2xl py-4 font-bold flex items-center justify-center gap-2 mb-6 active:scale-[0.98]`}><Plus size={18} /> 新增許願地點</button>
                                {wishlist.length === 0 && <div className="bg-[#F5F5F0] rounded-2xl h-32 flex items-center justify-center border border-stone-100 mb-8"><p className="text-stone-400 text-sm font-medium">尚未收藏任何地點</p></div>}
                                {wishlist.length > 0 && <div className="grid grid-cols-2 gap-3 mb-8">{wishlist.map(item => <div key={item.id} className="bg-white p-4 rounded-2xl shadow-sm border border-stone-100"><span className="font-bold text-stone-700">{item.name}</span></div>)}</div>}
                            </div>
                            <Modal isOpen={showThemeSettings} onClose={() => setShowThemeSettings(false)} title="風格設定">
                                <div className="space-y-6">
                                    <div className="flex justify-between gap-2 overflow-x-auto pb-2">{Object.entries(THEMES).map(([key, t]) => (<button key={key} onClick={() => setThemeColor(key)} className={`w-14 h-14 rounded-2xl ${t.primary} flex items-center justify-center text-white`}>{theme === t && <CheckCircle size={24} />}</button>))}</div>
                                    <button onClick={() => setShowThemeSettings(false)} className={`w-full py-4 ${theme.primary} text-white font-bold rounded-2xl`}>完成</button>
                                </div>
                            </Modal>
                            <Modal isOpen={showAddSpot} onClose={() => setShowAddSpot(false)} title="新增地點">
                                <div className="space-y-4">
                                    <input value={spotName} onChange={(e) => setSpotName(e.target.value)} placeholder="地點名稱" className="w-full bg-white border-2 border-stone-200 p-4 rounded-xl font-bold" />
                                    <button onClick={() => {if(spotName){setWishlist([...wishlist, {id: Date.now(), name: spotName}]); setSpotName(''); setShowAddSpot(false);}}} className={`w-full py-4 ${theme.primary} text-white font-bold rounded-xl`}>加入清單</button>
                                </div>
                            </Modal>
                        </div>
                    );
                };

                const ItineraryView = ({ theme }) => {
                    const [itinerary, setItinerary] = useState(INITIAL_ITINERARY);
                    const [currentDay, setCurrentDay] = useState(1);
                    const [isEditing, setIsEditing] = useState(false);
                    
                    // Modal State
                    const [isModalOpen, setIsModalOpen] = useState(false);
                    const [editingSpot, setEditingSpot] = useState(null);

                    const currentDayData = itinerary.find(d => d.day === currentDay);

                    // Helper to get icon component dynamically
                    const getIcon = (iconName) => {
                        const IconComp = Icons[iconName] || Icons.MapPin;
                        return <Icon path={IconComp} size={iconName === 'Train' || iconName === 'User' ? 12 : 20} />;
                    };

                    // Handlers
                    const handleDelete = (spotId) => {
                        const newItinerary = itinerary.map(day => {
                            if(day.day === currentDay) {
                                return { ...day, spots: day.spots.filter(s => s.id !== spotId) };
                            }
                            return day;
                        });
                        setItinerary(newItinerary);
                    };

                    const handleEditClick = (spot) => {
                        if (!isEditing) return;
                        setEditingSpot(spot);
                        setIsModalOpen(true);
                    };

                    const handleAddClick = () => {
                        setEditingSpot(null); // Null means adding new
                        setIsModalOpen(true);
                    };

                    const handleSaveSpot = (data) => {
                        const newItinerary = itinerary.map(day => {
                            if (day.day === currentDay) {
                                if (editingSpot) {
                                    // Edit existing
                                    return {
                                        ...day,
                                        spots: day.spots.map(s => s.id === editingSpot.id ? { ...s, ...data, icon: getIconNameByType(data.type) } : s)
                                    };
                                } else {
                                    // Add new
                                    return {
                                        ...day,
                                        spots: [...day.spots, { id: Date.now(), ...data, icon: getIconNameByType(data.type) }]
                                    };
                                }
                            }
                            return day;
                        });
                        setItinerary(newItinerary);
                    };

                    const getIconNameByType = (type) => {
                        switch(type) {
                            case 'food': return 'Utensils';
                            case 'shop': return 'ShoppingBag';
                            case 'transport': return 'Train';
                            case 'start': return 'Home';
                            case 'return': return 'Home';
                            default: return 'MapPin';
                        }
                    };

                    return (
                        <div className="pb-28 pt-4 bg-[#FDFCF8]">
                            <div className="flex overflow-x-auto gap-4 px-6 py-4 no-scrollbar mb-2 snap-x">
                                {itinerary.map((d) => (
                                    <button key={d.day} onClick={() => setCurrentDay(d.day)} className={`snap-center flex-shrink-0 w-[4.5rem] h-[4.5rem] rounded-full flex flex-col items-center justify-center transition-all duration-300 border-2 ${currentDay === d.day ? `${theme.primary} ${theme.border} text-white shadow-lg scale-105` : 'bg-white text-stone-400 border-stone-100'}`}>
                                        <span className="text-[10px] font-bold uppercase tracking-wider opacity-80">Day</span><span className="text-2xl font-serif font-bold">{d.day}</span>
                                    </button>
                                ))}
                            </div>
                            
                            <div className="px-6 mb-8 flex justify-between items-end">
                                <h2 className="text-4xl font-serif font-bold text-stone-800">Day {currentDay}</h2>
                                <div className="flex gap-2">
                                    <button onClick={() => setIsEditing(!isEditing)} className={`flex items-center gap-1.5 border px-4 py-2 rounded-full text-xs font-bold shadow-sm transition-all ${isEditing ? 'bg-stone-800 text-white border-stone-800' : 'bg-white border-stone-200 text-stone-600'}`}>
                                        {isEditing ? <><Save size={14}/> 完成</> : <><Edit size={14}/> 編輯</>}
                                    </button>
                                    {!isEditing && <button className="flex items-center gap-1.5 bg-white border border-stone-200 text-stone-600 px-4 py-2 rounded-full text-xs font-bold shadow-sm"><Sparkles size={14} /> AI 順路</button>}
                                </div>
                            </div>

                            <div className="relative px-4 pb-12">
                                <div className="absolute left-[2.25rem] top-4 bottom-4 w-0.5 bg-stone-200 -z-10"></div>
                                <div className="space-y-6">
                                    {currentDayData && currentDayData.spots.map((item) => {
                                        // Render logic based on type
                                        const isTransport = item.type === 'transport';
                                        const isStartOrReturn = item.type === 'start' || item.type === 'return';

                                        return (
                                            <div key={item.id} className="flex items-start gap-4 relative group">
                                                {/* Delete Button (Only in Edit Mode) */}
                                                {isEditing && (
                                                    <button onClick={() => handleDelete(item.id)} className="absolute -right-2 -top-2 bg-red-500 text-white p-1.5 rounded-full shadow-md z-20 animate-bounce">
                                                        <Trash size={14} />
                                                    </button>
                                                )}

                                                {/* Time Column */}
                                                <div className={`w-12 text-right flex-shrink-0 ${isTransport ? 'pt-2' : 'pt-1 text-sm'} font-bold ${isTransport ? 'text-stone-400 text-xs' : 'text-stone-600 font-mono'}`}>
                                                    {item.time}
                                                </div>

                                                {/* Main Content */}
                                                <div className="relative flex-1" onClick={() => handleEditClick(item)}>
                                                    {/* Dot/Icon on Line */}
                                                    {isTransport ? (
                                                        <div className="absolute -left-[2.6rem] w-5 h-5 bg-white border border-stone-200 rounded-full flex items-center justify-center z-10 text-stone-400">
                                                            {getIcon(item.icon)}
                                                        </div>
                                                    ) : (
                                                        <div className={`w-3 h-3 rounded-full ${isStartOrReturn ? 'bg-stone-800' : theme.primary} absolute -left-[2.45rem] top-2.5 ring-4 ring-[#FDFCF8]`}></div>
                                                    )}

                                                    {/* Card Content */}
                                                    {isTransport ? (
                                                        <div className={`bg-[#F5F5F0] px-3 py-1.5 rounded-lg flex items-center gap-2 text-xs font-bold text-stone-500 ${isEditing ? 'border-2 border-dashed border-stone-300 cursor-pointer' : ''}`}>
                                                            <Train size={12} /><span>{item.name}</span>
                                                        </div>
                                                    ) : isStartOrReturn ? (
                                                        <div className={`bg-white border border-stone-100 p-4 rounded-2xl shadow-sm flex items-center gap-4 ${isEditing ? 'border-2 border-dashed border-stone-300 cursor-pointer' : ''}`}>
                                                            <div className="bg-stone-100 p-2.5 rounded-xl text-stone-600">{getIcon(item.icon)}</div>
                                                            <div>
                                                                <p className="text-[10px] font-bold text-stone-400 uppercase tracking-wider mb-0.5">{item.type === 'start' ? 'START' : 'RETURN'}</p>
                                                                <h3 className="font-bold text-stone-800 text-lg">{item.name}</h3>
                                                                <button onClick={(e) => { e.stopPropagation(); window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.name)}`, '_blank'); }} className="flex items-center gap-1 text-xs text-stone-400 mt-1 hover:text-blue-600 hover:underline transition-colors">
                                                                    <Navigation size={10} /> {item.desc}
                                                                </button>
                                                            </div>
                                                        </div>
                                                    ) : (
                                                        <div className={`bg-white rounded-3xl overflow-hidden shadow-sm border border-stone-100 ${isEditing ? 'border-2 border-dashed border-stone-300 cursor-pointer' : ''}`}>
                                                            {item.img && (
                                                                <div className="h-32 w-full relative">
                                                                    <img src={item.img} className="w-full h-full object-cover" />
                                                                    <div className="absolute top-3 left-3 bg-white/90 backdrop-blur px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider text-stone-600 border border-white/50">{item.type}</div>
                                                                </div>
                                                            )}
                                                            <div className="p-4">
                                                                <h3 className="font-bold text-xl text-stone-800 mb-1">{item.name}</h3>
                                                                <div className="flex items-center gap-1 text-stone-400 text-xs mb-4"><MapPin size={12} /> {item.sub || item.desc}</div>
                                                                <button className="w-full py-2.5 rounded-xl border border-stone-200 text-stone-400 text-sm font-bold hover:bg-stone-50 transition-colors">{isEditing ? '編輯內容' : '移出'}</button>
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        );
                                    })}

                                    {/* Add Button (Only in Edit Mode) */}
                                    {isEditing && (
                                        <button onClick={handleAddClick} className="w-full py-4 border-2 border-dashed border-stone-300 rounded-2xl text-stone-400 font-bold flex items-center justify-center gap-2 hover:bg-stone-50 transition-colors ml-12 w-[calc(100%-3rem)]">
                                            <Plus size={20} /> 新增行程
                                        </button>
                                    )}
                                </div>
                            </div>

                            <EditSpotModal 
                                isOpen={isModalOpen} 
                                onClose={() => setIsModalOpen(false)} 
                                initialData={editingSpot} 
                                onSave={handleSaveSpot} 
                            />
                        </div>
                    );
                };

                // --- Other Views (Wallet, Shopping, Guide, TabBar, App) remain mostly same but simplified for length ---
                const WalletView = ({ theme }) => {
                    const [transactions, setTransactions] = useState([]);
                    const [showAdd, setShowAdd] = useState(false);
                    const [form, setForm] = useState({name:'', amount:''});
                    return (
                        <div className="pb-28 pt-6 px-6 bg-[#FDFCF8] min-h-full">
                            <div className={`bg-amber-500 rounded-3xl p-6 text-white shadow-lg mb-6`}>
                                <p className="text-xs opacity-80 font-bold">總支出</p>
                                <p className="text-3xl font-serif font-bold">¥{transactions.reduce((a,c)=>a+Number(c.amount),0).toLocaleString()}</p>
                            </div>
                            <div className="space-y-3">
                                {transactions.map(t=><div key={t.id} className="flex justify-between p-3 border-b"><span className="font-bold">{t.name}</span><span className="font-mono">-¥{t.amount}</span></div>)}
                            </div>
                            <button onClick={()=>setShowAdd(true)} className="w-full bg-stone-800 text-white py-4 rounded-2xl mt-6 font-bold">記一筆</button>
                            <Modal isOpen={showAdd} onClose={()=>setShowAdd(false)} title="記一筆">
                                <div className="space-y-4">
                                    <input value={form.name} onChange={e=>setForm({...form, name:e.target.value})} placeholder="項目" className="w-full bg-stone-50 p-3 rounded-xl" />
                                    <input value={form.amount} onChange={e=>setForm({...form, amount:e.target.value})} placeholder="金額" type="number" className="w-full bg-stone-50 p-3 rounded-xl" />
                                    <button onClick={()=>{setTransactions([...transactions, {id:Date.now(), ...form}]); setShowAdd(false); setForm({name:'', amount:''})}} className="w-full bg-amber-500 text-white py-3 rounded-xl font-bold">確認</button>
                                </div>
                            </Modal>
                        </div>
                    );
                };

                const ShoppingView = () => (
                    <div className="pb-28 pt-6 px-6 bg-[#FDFCF8] min-h-full flex flex-col items-center justify-center text-stone-300">
                        <ShoppingBag size={48} className="mb-2" />
                        <p className="font-bold">尚無商品</p>
                    </div>
                );

                const GuideView = () => (
                    <div className="pb-28 pt-12 px-6 bg-[#FDFCF8] min-h-full">
                        <h2 className="text-3xl font-serif font-bold text-stone-800 mb-8">旅のしおり</h2>
                        <div className="space-y-2">
                            {['護照', 'VJW', '網卡'].map(i => <div key={i} className="p-4 border rounded-xl flex items-center gap-3"><div className="w-4 h-4 rounded border"></div>{i}</div>)}
                        </div>
                    </div>
                );

                const TabBar = ({ activeTab, setActiveTab, theme }) => {
                    const tabs = [
                        { id: 'home', icon: 'List' }, { id: 'itinerary', icon: 'MapPin' }, 
                        { id: 'wallet', icon: 'Wallet' }, { id: 'shopping', icon: 'ShoppingBag' }, 
                        { id: 'guide', icon: 'User' }
                    ];
                    return (
                        <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-stone-100 px-6 py-4 flex justify-between items-center z-50 safe-area-bottom shadow-[0_-5px_30px_rgba(0,0,0,0.04)]">
                            {tabs.map(t => (
                                <button key={t.id} onClick={() => setActiveTab(t.id)} className={`flex flex-col items-center gap-1 ${activeTab === t.id ? theme.text : 'text-stone-300'}`}>
                                    <Icon path={Icons[t.icon]} size={26} strokeWidth={activeTab === t.id ? 2.5 : 2} />
                                </button>
                            ))}
                        </div>
                    );
                };

                const App = () => {
                    const [activeTab, setActiveTab] = useState('home');
                    const [themeColor, setThemeColor] = useState('gold');
                    const [showThemeSettings, setShowThemeSettings] = useState(false);
                    
                    // 修正高度問題
                    useEffect(() => {
                        const setVh = () => document.documentElement.style.setProperty('--vh', `${window.innerHeight * 0.01}px`);
                        setVh(); window.addEventListener('resize', setVh);
                        return () => window.removeEventListener('resize', setVh);
                    }, []);

                    return (
                        <div className="min-h-screen bg-[#F0F0F0] text-stone-800 font-sans flex justify-center">
                            <div className="w-full sm:max-w-md bg-[#FDFCF8] shadow-2xl overflow-hidden relative sm:my-8 sm:rounded-[2.5rem] flex flex-col h-[calc(var(--vh,1vh)*100)] sm:h-[90vh]">
                                <div className="flex-1 overflow-y-auto no-scrollbar scroll-smooth">
                                    {activeTab === 'home' && <HomeView theme={THEMES[themeColor]} setThemeColor={setThemeColor} setShowThemeSettings={setShowThemeSettings} showThemeSettings={showThemeSettings} />}
                                    {activeTab === 'itinerary' && <ItineraryView theme={THEMES[themeColor]} />}
                                    {activeTab === 'wallet' && <WalletView theme={THEMES[themeColor]} />}
                                    {activeTab === 'shopping' && <ShoppingView />}
                                    {activeTab === 'guide' && <GuideView />}
                                </div>
                                <TabBar activeTab={activeTab} setActiveTab={setActiveTab} theme={THEMES[themeColor]} />
                            </div>
                        </div>
                    );
                };

                const root = ReactDOM.createRoot(document.getElementById('root'));
                root.render(<App />);
            } catch (err) {
                console.error(err);
                document.body.innerHTML = `<div style="padding:20px;color:red">Error: ${err.message}</div>`;
            }
        });
    </script>
</body>
</html>
